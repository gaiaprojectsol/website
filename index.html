<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>The Gaia Project ‚Äî Send 0.1 SOL + Memo</title>
<style>
body{
  background:#000;color:#00ff99;font-family:"Courier New",monospace;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100vh;text-align:center;margin:0
}
h2{margin-bottom:1rem}
input,button{
  background:#000;color:#00ff99;border:1px solid #00ff99;
  border-radius:6px;padding:.6rem 1rem;margin-top:.6rem;
  font-family:"Courier New",monospace;width:80%;max-width:400px
}
button:hover{background:#00ff99;color:#000;cursor:pointer}
#status{margin-top:1rem;max-width:600px}
a{color:#00ff99}
</style>
</head>
<body>
<h2>üîå The Gaia Project ‚Äî Send 0.1 SOL + Memo</h2>

<input id="memoInput" placeholder="Enter your character name or message"><br>
<button id="sendBtn">Connect & Send 0.1 SOL</button>
<p id="status">Waiting for wallet‚Ä¶</p>

<script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.js"></script>

<script>
const statusEl   = document.getElementById("status");
const sendBtn    = document.getElementById("sendBtn");
const RECIPIENT  = new solanaWeb3.PublicKey("7qeCuMQUVhxfncxddC3A1SYQ4JnDhxJBBcrxhKDzfbs");
const LAMPORTS   = 0.1 * solanaWeb3.LAMPORTS_PER_SOL;
const MEMO_PROGRAM_ID = new solanaWeb3.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr");

window.addEventListener("load",()=>{
  if("solana" in window && (window.solana.isPhantom || window.phantom?.solana?.isPhantom)){
    statusEl.textContent="üü¢ Phantom detected ‚Äî enter a memo and click Send.";
  }else{
    statusEl.innerHTML='‚ùå Phantom not detected. <a href="https://phantom.app/download" target="_blank" style="color:#00ff99;">Install here</a>.';
  }
});

sendBtn.onclick = async ()=>{
  try{
    const provider = window.phantom?.solana || window.solana;
    if(!provider?.isPhantom) throw new Error("Phantom wallet not found");

    // Connect wallet
    const resp = await provider.request({ method:"connect" });
    const pubKey = provider.publicKey?.toString() || resp.publicKey?.toString();
    if(!pubKey) throw new Error("Failed to connect to Phantom");
    statusEl.textContent = "‚úÖ Connected: " + pubKey;

    const connection = new solanaWeb3.Connection(
      solanaWeb3.clusterApiUrl("mainnet-beta"), "confirmed"
    );

    const memoText = document.getElementById("memoInput").value.trim() || "Gaia supporter";

    // ‚úÖ Encode memo using native TextEncoder (no Buffer required)
    const memoIx = new solanaWeb3.TransactionInstruction({
      keys: [],
      programId: MEMO_PROGRAM_ID,
      data: new TextEncoder().encode(memoText),
    });

    const transferIx = solanaWeb3.SystemProgram.transfer({
      fromPubkey: provider.publicKey,
      toPubkey: RECIPIENT,
      lamports: LAMPORTS,
    });

    const tx = new solanaWeb3.Transaction().add(transferIx, memoIx);
    tx.feePayer = provider.publicKey;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    const signed = await provider.signTransaction(tx);
    const sig = await connection.sendRawTransaction(signed.serialize());
    await connection.confirmTransaction(sig, "confirmed");

    statusEl.innerHTML =
      `‚úÖ Sent 0.1 SOL to ${RECIPIENT.toBase58()}<br>`+
      `üìù Memo: ${memoText}<br>`+
      `<a href="https://solscan.io/tx/${sig}" target="_blank">View on Solscan</a>`;
  }catch(err){
    console.error(err);
    statusEl.textContent = "‚ùå " + (err.message || "Transaction failed.");
  }
};
</script>
</body>
</html>
