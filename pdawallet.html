<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solana Wallet Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0a0a0a;
    color: #fff;
    padding: 20px;
  }
  h1 { text-align: center; }
  #balanceBox {
    background: #111;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid #333;
    border-radius: 8px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  table th, table td {
    border: 1px solid #444;
    padding: 8px;
    text-align: left;
  }
  th { background: #222; }
  input.note-input {
    width: 95%;
    background: #222;
    color: #fff;
    border: 1px solid #555;
    padding: 5px;
    border-radius: 5px;
  }
</style>
</head>
<body>

<h1>Solana Wallet Balance Tracker</h1>

<div id="balanceBox">
  <h2>Current Balance:</h2>
  <p id="balance">Loading...</p>
</div>

<h2>Balance Ledger</h2>
<table>
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Old (SOL)</th>
      <th>New (SOL)</th>
      <th>Change</th>
      <th>Note</th>
    </tr>
  </thead>
  <tbody id="ledgerBody"></tbody>
</table>

<script>

// === SETTINGS ===
const WALLET = "7qeCuMQUVhxfncxddC3A1SYQ4JnDhxJBBcrxhKDzfbs";
const RPC = "https://mainnet.helius-rpc.com/?api-key=d616d97c-62dc-4962-b859-54861377cd5b";

let lastBalance = null;

// === Local storage key ===
const NOTES_KEY = "solanaLedgerNotes";
let notes = JSON.parse(localStorage.getItem(NOTES_KEY) || "{}");

// === Save notes back into localStorage ===
function saveNotes() {
  localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
}

// === Fetch balance from Solana ===
async function getBalance() {
  const res = await fetch(RPC, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      jsonrpc: "2.0",
      id: 1,
      method: "getBalance",
      params: [WALLET]
    })
  });

  const data = await res.json();
  return data.result.value / 1_000_000_000;
}

// === Add row to ledger ===
function addLedgerRow(oldBal, newBal) {
  const change = (newBal - oldBal).toFixed(4);
  const timestamp = new Date().toLocaleString();
  const rowId = timestamp.replace(/\s+/g, "_"); // unique row key

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${timestamp}</td>
    <td>${oldBal.toFixed(4)}</td>
    <td>${newBal.toFixed(4)}</td>
    <td>${change}</td>
    <td>
      <input class="note-input" id="note-${rowId}" placeholder="Add note..." value="${notes[rowId] || ""}">
    </td>
  `;

  // Save note when typed
  tr.querySelector("input").addEventListener("input", (e) => {
    notes[rowId] = e.target.value;
    saveNotes();
  });

  document.getElementById("ledgerBody").prepend(tr);
}

// === Update tracker ===
async function updateBalance() {
  try {
    const newBal = await getBalance();
    document.getElementById("balance").innerText =
      newBal.toFixed(4) + " SOL";

    if (lastBalance === null) {
      // FIRST ENTRY â€” you requested this
      lastBalance = newBal;
      addLedgerRow(newBal, newBal);
      return;
    }

    if (newBal !== lastBalance) {
      addLedgerRow(lastBalance, newBal);
      lastBalance = newBal;
    }

  } catch (e) {
    document.getElementById("balance").innerText = "Error fetching balance";
    console.error(e);
  }
}

// === Start ===
updateBalance();
setInterval(updateBalance, 10_000);

</script>
</body>
</html>
