<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gaia Project ‚Äî Wallet Memo Reader</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
  body {
    background: #000;
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    padding: 40px;
  }

  h1 {
    color: #00ffe0;
    text-shadow: 0 0 12px #00ffe0;
  }

  input {
    width: 420px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #00ffe033;
    background: #111;
    color: #fff;
    font-size: 15px;
  }

  button {
    padding: 12px 22px;
    background: #00ffe0;
    color: #000;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-left: 10px;
  }

  button:hover {
    background: #00c8b0;
  }

  #output {
    margin-top: 30px;
    font-size: 16px;
    line-height: 1.7;
  }

  .memo-card {
    border: 1px solid #00ffe055;
    padding: 15px;
    margin-bottom: 22px;
    border-radius: 10px;
    background: #0f0f0f;
    box-shadow: 0 0 12px #00ffe022;
  }

  a {
    color: #00ffe0;
  }

  a:hover {
    color: #fff;
  }
</style>
</head>

<body>

<h1>üîç Solana Wallet Memo Reader</h1>
<p>Enter any Solana wallet address to retrieve its most recent memo transactions.</p>

<input id="wallet" type="text" placeholder="Enter Solana wallet address">
<button onclick="readWalletMemos()">Read Memos</button>

<div id="output"></div>

<script type="module">
  import * as solanaWeb3 from "https://esm.sh/@solana/web3.js@1.95.3";
  import bs58 from "https://esm.sh/bs58@5.0.0";

  window.readWalletMemos = async function () {
    const pubkeyInput = document.getElementById("wallet").value.trim();
    const output = document.getElementById("output");
    output.innerHTML = "Loading...";

    try {
      const connection = new solanaWeb3.Connection(
        "https://mainnet.helius-rpc.com/?api-key=d616d97c-62dc-4962-b859-54861377cd5b",
        "confirmed"
      );

      const pubkey = new solanaWeb3.PublicKey(pubkeyInput);

      const signatures = await connection.getSignaturesForAddress(pubkey, { limit: 50 });

      let results = [];

      for (let siginfo of signatures) {
        const tx = await connection.getTransaction(siginfo.signature, {
          maxSupportedTransactionVersion: 0
        });

        if (!tx) continue;

        const memoProgram = "MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr";

        for (let inst of tx.transaction.message.instructions) {

          const programId = tx.transaction.message.accountKeys[inst.programIdIndex];
          if (!programId) continue;

          if (programId.toBase58() === memoProgram) {

            // ‚≠ê FIX: decode memo from base58
            const memoBytes = bs58.decode(inst.data);
            const memo = new TextDecoder().decode(memoBytes);

            results.push({
              signature: siginfo.signature,
              memo: memo,
              slot: tx.slot,
              time: tx.blockTime
            });
          }
        }
      }

      if (results.length === 0) {
        output.innerHTML = "<p>No memo transactions found.</p>";
        return;
      }

      output.innerHTML = "<h2>üìú Memo Transactions Found:</h2>";

      results.forEach(r => {
        const date = r.time
          ? new Date(r.time * 1000).toUTCString()
          : "Unknown";

        output.innerHTML += `
          <div class="memo-card">
            <p><strong>Signature:</strong><br>
            <a href="https://explorer.solana.com/tx/${r.signature}" target="_blank">
              ${r.signature}
            </a></p>

            <p><strong>Memo:</strong><br>${r.memo}</p>

            <p><strong>Block Time:</strong><br>${date}</p>
          </div>
        `;
      });

    } catch (err) {
      output.innerHTML = "‚ùå Error: " + err.message;
    }
  };
</script>

</body>
</html>
