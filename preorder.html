<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gaia Project ‚Äî Pre-Order + Custom Genean Tracker</title>
<link rel="icon" type="image/png" href="gaiaprojectwhite.png" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: 'Orbitron', sans-serif;
    background: radial-gradient(circle at center, #000, #020b0b, #000);
    color: #fff;
  }

  /* ANNOUNCEMENT BAR */
  #announcement-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 32px;
    width: 100%;
    background: linear-gradient(90deg, #00ffd5, #0088ff, #8a2be2);
    color: #000;
    font-weight: bold;
    line-height: 32px;
    text-align: center;
    overflow: hidden;
    z-index: 999;
  }
  #announcement-text {
    white-space: nowrap;
    display: inline-block;
    padding-left: 100%;
    animation: scrollText 16s linear infinite;
  }
  @keyframes scrollText {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }

  /* HEADER */
  header {
    position: fixed;
    top: 32px;
    left: 0;
    width: 100%;
    padding: 14px 24px;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(4px);
    border-bottom: 1px solid #00ffe033;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 998;
  }
  header img { height: 40px; }

  nav a {
    color: #00e5ff;
    text-decoration: none;
    margin: 0 12px;
    font-size: 14px;
    transition: 0.3s;
  }
  nav a:hover {
    color: #8affff;
    text-shadow: 0 0 8px #00eaff;
  }

  /* CONNECT WALLET BUTTON */
  #connectWalletBtn {
    background: #00ffe0;
    color: #000;
    font-weight: bold;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.25s ease;
  }
  #connectWalletBtn:hover {
    background: #00cbb3;
    transform: scale(1.05);
  }

  /* MAIN CONTENT */
  .content {
    max-width: 850px;
    margin: 160px auto 80px auto;
    padding: 20px;
    text-align: center;
  }
  h1 { font-size: 2.4rem; color: #5cecff; }
  .subtitle { color: #aaa; font-size: 1rem; }

  .spark-img img {
    width: 240px;
    height: 240px;
    object-fit: cover;
    border-radius: 15px;
    margin-top: 30px;
    box-shadow: 0 0 25px #00ffe055;
    transition: 0.4s;
  }
  .spark-img img:hover {
    transform: scale(1.05);
    box-shadow: 0 0 40px #00ffe0aa;
  }
  .caption { margin-top: 10px; color: #00ffe0; }

  input {
    margin-top: 20px;
    font-family: 'Orbitron', sans-serif;
    width: 280px;
    padding: 12px;
    border-radius: 6px;
    border: none;
  }

  button {
    margin-top: 10px;
    font-family: 'Orbitron', sans-serif;
    padding: 14px 34px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    background: #14F195;
    color: #000;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover { background: #0bb07b; transform: scale(1.05); }

  /* TRACKER */
  .tracker-wrapper {
    max-width: 850px;
    margin: 40px auto;
  }
  .tracker-header {
    padding: 18px 24px;
    background: linear-gradient(90deg, #033, #066, #033);
    border: 1px solid #00ffc880;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 0 18px #00ffd255;
    transition: 0.3s ease;
  }
  .tracker-header:hover { box-shadow: 0 0 25px #00ffd2aa; }
  .tracker-header h2 {
    margin: 0;
    font-size: 1.4rem;
    color: #5cecff;
  }
  .tracker-content {
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.6s ease;
    border: 1px solid #003b35;
    border-radius: 10px;
    background: #001818;
    margin-top: 10px;
    padding: 0 20px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
  }
  td {
    padding: 12px;
    border-bottom: 1px solid #033;
  }
  .taken { color: #7affc6; }
  .empty { color: #444; }

  #refresh-btn {
    display: block;
    margin: 0 auto 20px;
    background: #009688;
    padding: 10px 26px;
    border-radius: 8px;
    color: #fff;
    cursor: pointer;
  }

  /* FOOTER */
  footer {
    text-align: center;
    padding: 30px;
    background: #050505;
    border-top: 1px solid #111;
    color: #999;
  }
  footer a { color: #00ffe0; }
  footer a:hover { color: #fff; }

</style>
</head>

<body>

<!-- ANNOUNCEMENT -->
<div id="announcement-bar">
  <div id="announcement-text">
    üåç Mint opens November 27th ‚Äî Pre-order your Gaia Spark today! ‚ö°
  </div>
</div>

<!-- HEADER -->
<header>
  <img src="gaiaprojectwhite.png" />

  <nav>
    <a href="index.html">Home</a>
    <a href="lore.html">Lore</a>
    <a href="preorder.html">Pre-Order</a>
    <a href="whitepaper.html">Whitepaper</a>
    <a href="community.html">Community</a>
    <a href="blog.html">Blog</a>
  </nav>

  <button id="connectWalletBtn">Connect Wallet</button>
</header>

<!-- MAIN CONTENT -->
<div class="content">
  <h1>Pre-Order Your Gaia Spark</h1>
  <p class="subtitle">Reserve your Genesis Genean before the Awakening begins.</p>

  <div class="spark-img">
    <img src="gaia-spark.png" />
    <p class="caption">The Gaia Spark ‚Äî the beginning of your Chainline</p>
  </div>

 <p>
  Only <strong>100 of the 4200 Geneans will be custom named</strong>.  
  Once the <strong>100 slots are filled</strong> or when the mint opens on  
  <strong>27 November</strong>, this feature becomes <strong>immutable</strong>.
</p>

<p>
  This is a once-in-history moment to permanently write your chosen name  
  into the DNA of the first generation of Gaia.
</p>

<p>
  After mint opens, <strong>no more custom names will ever exist again</strong>.
</p>

  <p>Enter your Genean name, then press claim to send <strong>0.1 SOL</strong>:</p>

  <input id="memo" type="text" placeholder="e.g. Lord Fardrosan" />
  <br />
  <button id="send">Claim Your Gaia Spark</button>
</div>


<!-- TRACKER -->
<div class="tracker-wrapper">

  <div class="tracker-header" onclick="toggleTracker()">
    <h2>Click to Show the List of Reserved Custom Geneans</h2>
  </div>

  <div id="tracker-content" class="tracker-content">
    <div id="tracker-status">Loading‚Ä¶</div>
    <button id="refresh-btn" onclick="refreshTracker()">Refresh</button>
    <div id="soldout-banner" style="display:none;">üî• SOLD OUT ‚Äî All 100 Custom Geneans Taken üî•</div>

    <table><tbody id="tracker-body"></tbody></table>
  </div>
</div>

<!-- FOOTER -->
<footer>
  Join the conversation:
  <a href="https://x.com/gaiaprojectsol" target="_blank">X</a> |
  <a href="https://t.me/+g9xscMa9_AtiMzU1" target="_blank">Telegram</a>
  <p>¬© 2025 Gaia Project ‚Äî All rights reserved.</p>
</footer>


<!-- IMPORT SOLANA -->
<script type="module">
  import * as solanaWeb3 from "https://esm.sh/@solana/web3.js@1.95.3";
  window.solanaWeb3 = solanaWeb3;
</script>

<script type="module">
  import bs58 from "https://esm.sh/bs58@5.0.0";

  const RECEIVING_WALLET = "7qeCuMQUVhxfncxddC3A1SYQ4JnDhxJBBcrxhKDzfbs";
  const RPC = "https://mainnet.helius-rpc.com/?api-key=d616d97c-62dc-4962-b859-54861377cd5b";
  const MEMO_PROGRAM = "MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr";

  let trackerLoaded = false;
  let trackerLoading = false;

  async function rpcCall(method, params) {
    const res = await fetch(RPC, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        jsonrpc: "2.0",
        id: 1,
        method,
        params
      })
    });
    const json = await res.json();
    if (json.error) throw new Error(json.error.message);
    return json.result;
  }

  function decodeMemo(data) {
    try { return new TextDecoder().decode(bs58.decode(data)); }
    catch { return null; }
  }

  function extractMemos(tx) {
    const list = [];
    const msg = tx?.transaction?.message;
    if (!msg) return list;

    const keys = msg.accountKeys ?? [];

    if (Array.isArray(msg.instructions)) {
      for (const i of msg.instructions) {
        const pid = keys[i.programIdIndex];
        if (pid === MEMO_PROGRAM) {
          const m = decodeMemo(i.data);
          if (m) list.push(m);
        }
      }
    }

    if (tx.meta?.innerInstructions) {
      for (const inner of tx.meta.innerInstructions) {
        for (const inst of inner.instructions) {
          const pid = keys[inst.programIdIndex];
          if (pid === MEMO_PROGRAM) {
            const m = decodeMemo(inst.data);
            if (m) list.push(m);
          }
        }
      }
    }

    return list;
  }

  window.toggleTracker = async function () {
    const panel = document.getElementById("tracker-content");

    if (trackerLoaded) {
      panel.style.maxHeight = panel.style.maxHeight ? null : panel.scrollHeight + "px";
      return;
    }

    if (trackerLoading) return;

    trackerLoading = true;
    panel.style.maxHeight = panel.scrollHeight + "px";

    await loadTracker();
    trackerLoaded = true;
    trackerLoading = false;

    panel.style.maxHeight = panel.scrollHeight + "px";
  };

  window.refreshTracker = async function () {
    trackerLoaded = false;
    trackerLoading = false;
    document.getElementById("tracker-body").innerHTML = "";
    document.getElementById("tracker-status").innerHTML = "Loading‚Ä¶";

    const panel = document.getElementById("tracker-content");
    panel.style.maxHeight = panel.scrollHeight + "px";

    await loadTracker();

    panel.style.maxHeight = panel.scrollHeight + "px";
  };

  async function loadTracker() {
    const body = document.getElementById("tracker-body");
    const status = document.getElementById("tracker-status");
    const soldout = document.getElementById("soldout-banner");

    body.innerHTML = "";
    status.innerHTML = "Loading‚Ä¶";

    try {
      const sigs = await rpcCall("getSignaturesForAddress", [
        RECEIVING_WALLET,
        { limit: 200 }
      ]);

      const entries = [];

      for (const s of sigs) {
        const tx = await rpcCall("getTransaction", [
          s.signature,
          { encoding: "json", maxSupportedTransactionVersion: 0 }
        ]);
        if (!tx) continue;

        const memos = extractMemos(tx);
        if (memos.length > 0) entries.push({ memo: memos[0] });
      }

      entries.reverse();

      const count = entries.length;
      status.innerHTML = `Custom Geneans Reserved: <strong>${count} / 100</strong>`;
      soldout.style.display = count >= 100 ? "block" : "none";
      body.innerHTML = "";

      for (let i = 1; i <= 100; i++) {
        const tr = document.createElement("tr");

        if (entries[i - 1]) {
          tr.innerHTML = `
            <td class="taken">${i}</td>
            <td class="taken">${entries[i - 1].memo}</td>
          `;
        } else {
          tr.innerHTML = `
            <td class="empty">${i}</td>
            <td class="empty">‚Äî</td>
          `;
        }

        body.appendChild(tr);
      }

    } catch (e) {
      status.innerHTML = "‚ùå Error: " + e.message;
    }
  }

  /* PREORDER LOGIC */
  const sendButton = document.getElementById("send");

  sendButton.addEventListener("click", async () => {
    try {
      const provider = window.solana;
      if (!provider || !provider.isPhantom) {
        alert("Please install Phantom Wallet ‚Üí https://phantom.app");
        return;
      }

      await provider.connect();
      const connection = new solanaWeb3.Connection(RPC);

      const recipient = new solanaWeb3.PublicKey(RECEIVING_WALLET);
      const tx = new solanaWeb3.Transaction().add(
        solanaWeb3.SystemProgram.transfer({
          fromPubkey: provider.publicKey,
          toPubkey: recipient,
          lamports: 0.1 * 1e9
        })
      );

      const memoText = document.getElementById("memo").value.trim();
      if (memoText) {
        tx.add(
          new solanaWeb3.TransactionInstruction({
            keys: [],
            programId: new solanaWeb3.PublicKey(MEMO_PROGRAM),
            data: new TextEncoder().encode(memoText)
          })
        );
      }

      tx.feePayer = provider.publicKey;
      tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

      const signed = await provider.signTransaction(tx);
      const sig = await connection.sendRawTransaction(signed.serialize());
      await connection.confirmTransaction(sig, "confirmed");

      alert("‚úÖ Pre-order complete!\n\nTransaction Signature:\n" + sig);
      window.open(`https://explorer.solana.com/tx/${sig}`, "_blank");

    } catch (err) {
      alert("‚ùå Error: " + err.message);
    }
  });

</script>

<!-- CONNECT WALLET SCRIPT ‚Äî MUST NOT BE MODULE -->
<script>
  const connectWalletBtn = document.getElementById("connectWalletBtn");

  async function connectWallet() {
    const provider = window.solana;

    if (!provider || !provider.isPhantom) {
      alert("Please install Phantom Wallet ‚Üí https://phantom.app");
      return;
    }

    try {
      const resp = await provider.connect();
      const wallet = resp.publicKey.toString();
      const short = wallet.slice(0, 4) + "..." + wallet.slice(-4);

      connectWalletBtn.innerText = short;
      connectWalletBtn.style.background = "#0bb07b";
      connectWalletBtn.style.color = "#fff";

    } catch (e) {
      console.error("Wallet connect error:", e);
    }
  }

  connectWalletBtn.addEventListener("click", connectWallet);
</script>

</body>
</html>
